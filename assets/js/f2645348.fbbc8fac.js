(self.webpackChunkyle_blog=self.webpackChunkyle_blog||[]).push([[1073],{20895:function(e,t,n){"use strict";n.d(t,{dK:function(){return o},_k:function(){return s},vc:function(){return l},rx:function(){return r},qo:function(){return c},Hk:function(){return d},Iz:function(){return m}});var i=n(31336),a=n.n(i);n(30892)(a()),n(54212).w(a()),n(74182)(a());var o=["en","zh"],s=!1,l=null,r="5228ca85",c=8,d=50,m={search_placeholder:"Search",see_all_results:"\u67e5\u770b\u6240\u6709\u76f8\u5173\u7ed3\u679c\ud83d\udc40",no_results:"\u62b1\u6b49\uff0c\u6682\u65f6\u6ca1\u6709\u8fd9\u65b9\u9762\u7684\u6587\u7ae0\ud83d\ude23.",search_results_for:'\u5173\u4e8e "{{ keyword }}" \u7684\u6240\u6709\u6587\u7ae0',search_the_documentation:"\u4ece\u5f53\u524d\u7ad9\u70b9\u4e2d\u67e5\u627e\u5173\u952e\u5b57",count_documents_found:"\u4e00\u5171\u627e\u5230\u4e86 {{ count }} \u7bc7\u76f8\u5173\u6587\u7ae0\ud83d\udc40",count_documents_found_plural:"\u4e00\u5171\u627e\u5230\u4e86 {{ count }} \u7bc7\u76f8\u5173\u6587\u7ae0\ud83d\udc40",no_documents_were_found:"\u5565\u4e5f\u6ca1\u627e\u5230\uff0c\u6362\u4e00\u4e2a\u5173\u952e\u8bcd\u5427\ud83d\ude35"}},77758:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var i,a,o,s,l,r,c,d,m,u,h=n(63349),v=n(41788),f=n(96156),p=n(67294),g=n(86591),w=n(99105),E=n(2212),x=n(52886),M=n(17047),b=n(29276),k=n(36194),y=n.p+"assets/images/grasslight-big-43728102ca7c7ab4a5e3eedb0572f7b9.jpg",S=function(e){function t(){var t;return t=e.call(this)||this,(0,f.Z)((0,h.Z)(t),"initDialog",(function(){(c=document.createElement("div")).className="model-dialog";var e=document.createElement("div");(m=document.createElement("a")).target="_blank",e.appendChild(m),u=document.createElement("div"),c.append(e,u),(d=new b.j(c)).name="dialog"})),(0,f.Z)((0,h.Z)(t),"clickLabel",(function(e){var n=e.target.name,i=n&&t.modelsMap[n];if(i){var s=i.model;if(s.activeEmote("Wave"),o.getObjectByName("dialog"))o.remove(d);else{var l=s.model.position;d.position.set(l.x,l.y+450,l.z),setTimeout((function(){return s.pause=!0}),2e3),m.innerText=i.friendName,m.href=i.friendAddr,u.innerText=i.aWord,o.add(d);var r=1200*Math.sin(s.angle),c=1200*Math.cos(s.angle),h=r+s.model.position.x,v=c+s.model.position.z;new k.kX(a.position).to({x:h,y:400,z:v},800).easing(k.oY.Quadratic.Out).start().onComplete((function(){a.lookAt(l)})),t.lastActiveModel=s}}else o.getObjectByName("dialog")&&(o.remove(d),t.lastActiveModel&&(t.lastActiveModel.activeEmote("Wave"),t.lastActiveModel=null))})),(0,f.Z)((0,h.Z)(t),"getMouse",(function(e){var t=i.domElement,n=new E.FM8;return n.x=(e.clientX-t.getBoundingClientRect().left)/t.offsetWidth*2-1,n.y=-(e.clientY-t.getBoundingClientRect().top)/t.offsetHeight*2+1,n})),(0,f.Z)((0,h.Z)(t),"getIntersects",(function(e){var t=new E.iMs;t.setFromCamera(e,a);var n=t.intersectObjects(o.children);if(n.length)return n[0]})),(0,f.Z)((0,h.Z)(t),"onWindowResize",(function(){console.log("resize");var e=l.clientWidth,t=l.clientHeight;a.aspect=e/t,a.updateProjectionMatrix(),i.setSize(e,t),r.setSize(e,t)})),(0,f.Z)((0,h.Z)(t),"renderLoop",(function(){t.models.forEach((function(e){e.update()})),i.render(o,a),r.render(o,a),t.rfa=requestAnimationFrame(t.renderLoop),k.Vx()})),t.models=[],t.modelsMap={},t.lastActiveModel=null,t}(0,v.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;l=document.getElementById("friends-canvas-container");var t=document.getElementById("friends-canvas"),n=l.clientHeight,c=l.clientWidth;(i=new E.CP7({canvas:t,antialias:!0})).setPixelRatio(window.devicePixelRatio),i.setSize(c,n),(r=new b.M).setSize(c,n),r.domElement.style.position="absolute",r.domElement.style.top="60px",r.domElement.style.zIndex="1000",l.appendChild(r.domElement),(a=new E.cPb(60,c/n,1,3e4)).position.set(1e3,50,1500),(o=new E.xsS).background=new E.Ilk(13426943),o.fog=new E.ybr(13426943,500,1e4),o.add(new E.Mig(6710886));var d=new E.Ox3(14674943,1);d.position.set(50,200,100),d.position.multiplyScalar(1.3),d.castShadow=!0,d.shadow.mapSize.width=1024,d.shadow.mapSize.height=1024;var m=300;d.shadow.camera.left=-m,d.shadow.camera.right=m,d.shadow.camera.top=m,d.shadow.camera.bottom=-m,d.shadow.camera.far=1e3,o.add(d),(s=new x.z(a,r.domElement)).maxPolarAngle=.5*Math.PI,s.minDistance=50,s.maxDistance=5e3;var u=(new E.dpR).load(y);u.wrapS=u.wrapT=E.rpg,u.repeat.set(25,25),u.anisotropy=16,u.encoding=E.knz;var h=new E.YBo({map:u}),v=new E.Kj0(new E._12(2e4,2e4),h);v.position.y=-250,v.rotation.x=-Math.PI/2,v.receiveShadow=!0,o.add(v);this.friends;fetch("https://qc9pvu.fn.thelarkcloud.com/getFriendList").then((function(e){if(e.ok)return e.json();throw new Error("\u83b7\u53d6\u6570\u636e\u5931\u8d25")})).then((function(t){t.forEach((function(t){var n=t.friendName,i=(t.friendAddr,t.aWord,new z({name:n}));i.init(),e.models.push(i),t.model=i,e.modelsMap[n]=t}))})).catch((function(e){return console.log(e)})),this.initDialog(),window.addEventListener("resize",this.onWindowResize),r.domElement.addEventListener("click",this.clickLabel),this.renderLoop()},n.componentWillUnmount=function(){this.models.forEach((function(e){e.despose()})),o.traverse((function(e){"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})),window.removeEventListener("resize",this.onWindowResize),r.domElement.removeEventListener("click",this.clickLabel),cancelAnimationFrame(this.rfa)},n.render=function(){return p.createElement(g.Z,null,p.createElement(w.Z,null,p.createElement("title",null,"\u53cb\u94fe\uff08\u672a\u5b8c\u5de5\uff09 | Yle")),p.createElement("div",{id:"friends-canvas-container"},p.createElement("canvas",{id:"friends-canvas"})))},t}(p.Component),z=function(e){var t=this,n=e.name;(0,f.Z)(this,"init",(function(){t.clock=new E.SUY,(new M.E).load("https://cdn.jsdelivr.net/gh/yleave/yle-blog/models/RobotExpressive.glb",(function(e){var n=e.scene;n.scale.set(60,60,60),n.position.y=-250;var i=e.animations;t.mixer=new E.Xcj(n);for(var a=0;a<i.length;a++){var s=i[a],l=t.mixer.clipAction(s);t.actions[s.name]=l,(t.emotes.indexOf(s.name)>=0||t.state.indexOf(s.name)>=4)&&(l.clampWhenFinished=!0,l.loop=E.jAl)}t.activeAction=t.actions[t.activeState],t.activeAction.play(),n.rotateY(t.angle),o.add(n),t.model=n;var r=n.position.clone();r.y=65;var c=t.createLabel(t.name,r);t.label=c,o.add(c)}))})),(0,f.Z)(this,"activeEmote",(function(e){t.pause=!0,t.fadeToAction(e,.2),t.mixer.addEventListener("finished",t.restoreState)})),(0,f.Z)(this,"restoreState",(function(){t.mixer.removeEventListener("finished",t.restoreState),t.fadeToAction(t.activeState,.2),t.pause=!1})),(0,f.Z)(this,"update",(function(){var e=null!=t.model&&!t.pause,n=+new Date;if(n-t.prevTime>1e4){t.prevTime=n;var i=t.state[Math.floor(Math.random()*t.state.length)];console.log(i),i!==t.activeState&&e&&(t.activeState=i,t.fadeToAction(i,.5),t.model.rotateY(-t.angle),t.angle=2*Math.random()*Math.PI,t.model.rotateY(t.angle))}var a=t.clock.getDelta();t.mixer&&t.mixer.update(a),!e||"Walking"!==t.activeState&&"Running"!==t.activeState||t.move()})),(0,f.Z)(this,"move",(function(){var e=t.speed[t.activeState],n=Math.sin(t.angle)*e,i=Math.cos(t.angle)*e,a=n+t.model.position.x,o=i+t.model.position.z;(a>=2e3||a<=-2e3||o>=2e3||o<=-2e3)&&(console.log("change angle"),t.model.rotateY(-t.angle),t.angle=(t.angle+Math.PI)%(2*Math.PI),t.model.rotateY(t.angle),n=Math.sin(t.angle)*e,i=Math.cos(t.angle)*e,a=n+t.model.position.x,o=i+t.model.position.z),t.label.position.x=a,t.label.position.z=o,t.model.position.x=a,t.model.position.z=o})),(0,f.Z)(this,"createLabel",(function(e,t){var n=document.createElement("div");n.className="model-label",n.textContent=e,n.name=e;var i=new b.j(n);return i.position.set(t.x,t.y,t.z),i})),(0,f.Z)(this,"despose",(function(){var e=t.activeAction,n=t.model;t.mixer.uncacheAction(e,n)})),(0,f.Z)(this,"fadeToAction",(function(e,n){var i=t.activeAction,a=i;i=t.actions[e],a.fadeOut(n),i.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(n).play(),t.activeAction=i})),this.state=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],this.emotes=["Jump","Yes","No","Wave","Punch","ThumbsUp"],this.activeState="Walking",this.mixer=null,this.model=null,this.actions={},this.activeAction=null,this.prevTime=+new Date,this.clock=null,this.speed={Walking:3,Running:5},this.angle=2*Math.random()*Math.PI,this.label=null,this.pause=!1,this.name=n}}}]);
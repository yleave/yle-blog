"use strict";(self.webpackChunkyle_blog=self.webpackChunkyle_blog||[]).push([[4831],{81752:function(e,n,t){var a=t(15851);n.Z=function(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},5410:function(e,n,t){t.d(n,{Z:function(){return p}});var a=t(15851),r=t(3131);var l=function(){var e=(0,a.useContext)(r.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},i=t(44927),o="tabItem_60p2",c="tabItemActive_3zow";var p=function(e){var n,t=e.lazy,r=e.block,p=e.defaultValue,s=e.values,m=e.groupId,u=e.className,d=a.Children.toArray(e.children),k=null!=s?s:d.map((function(e){return{value:e.props.value,label:e.props.label}})),g=null!=p?p:null==(n=d.find((function(e){return e.props.default})))?void 0:n.props.value,N=l(),h=N.tabGroupChoices,f=N.setTabGroupChoices,v=(0,a.useState)(g),b=v[0],C=v[1],w=[];if(null!=m){var y=h[m];null!=y&&y!==b&&k.some((function(e){return e.value===y}))&&C(y)}var E=function(e){var n=e.currentTarget,t=w.indexOf(n),a=k[t].value;C(a),null!=m&&(f(m,a),setTimeout((function(){var e,t,a,r,l,i,o,p;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,l=e.right,i=window,o=i.innerHeight,p=i.innerWidth,t>=0&&l<=p&&r<=o&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(c),setTimeout((function(){return n.classList.remove(c)}),2e3))}),150))},T=function(e){var n,t=null;switch(e.key){case"ArrowRight":var a=w.indexOf(e.target)+1;t=w[a]||w[0];break;case"ArrowLeft":var r=w.indexOf(e.target)-1;t=w[r]||w[w.length-1]}null==(n=t)||n.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.default)("tabs",{"tabs--block":r},u)},k.map((function(e){var n=e.value,t=e.label;return a.createElement("li",{role:"tab",tabIndex:b===n?0:-1,"aria-selected":b===n,className:(0,i.default)("tabs__item",o,{"tabs__item--active":b===n}),key:n,ref:function(e){return w.push(e)},onKeyDown:T,onFocus:E,onClick:E},null!=t?t:n)}))),t?(0,a.cloneElement)(d.filter((function(e){return e.props.value===b}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},d.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==b})}))))}},13225:function(e,n,t){var a=t(15851);n.Z=function(e){var n=e.children,t=e.color;return a.createElement("span",{style:{backgroundColor:t||"#0099CC",borderRadius:"4px",color:"white",padding:"0.2rem"}},n)}},69491:function(e,n,t){t.d(n,{Z:function(){return N}});var a=t(12175),r=t(61694),l=(t(89862),t(7032)),i=t(15851),o=t(89042),c=t.n(o),p=t(23159),s=t.n(p),m=t(91144),u=t(75294),d=["node","inline","className","children"],k=l.Z.Panel,g={code:function(e){e.node;var n=e.inline,t=e.className,l=e.children,o=(0,r.Z)(e,d),c=/language-(\w+)/.exec(t||"");return!n&&c?i.createElement(m.Z,(0,a.Z)({style:u.Z,language:c[1],PreTag:"div",children:String(l).replace(/\n$/,"")},o)):i.createElement("code",(0,a.Z)({className:t},o))}};function N(e){var n=e.markdown,t=e.header,a=e.OtherComponents;return i.createElement(l.Z,{bordered:!1,style:{paddingBottom:"1.5rem"}},i.createElement(k,{header:t},i.createElement(c(),{components:g,children:""+n,remarkPlugins:[s()]}),a?i.createElement(a,null):null))}},81839:function(e,n,t){t.r(n),t.d(n,{contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return p},metadata:function(){return m},toc:function(){return u}});var a=t(12175),r=t(61694),l=(t(15851),t(99278)),i=(t(13225),t(60497)),o=(t(5410),t(81752),t(8385)),c=(t(69491),["components"]),p={slug:"front-end-code3",title:"\u524d\u7aef\u4ee3\u7801\u98983"},s=void 0,m={unversionedId:"interview/\u516b\u80a1\u6587/2021-10-20-front-end-code3",id:"interview/\u516b\u80a1\u6587/2021-10-20-front-end-code3",isDocsHomePage:!1,title:"\u524d\u7aef\u4ee3\u7801\u98983",description:"1. \u6570\u7ec4\u53bb\u91cd",source:"@site/docs/interview/\u516b\u80a1\u6587/2021-10-20-front-end-code3.md",sourceDirName:"interview/\u516b\u80a1\u6587",slug:"/interview/\u516b\u80a1\u6587/front-end-code3",permalink:"/docs/interview/\u516b\u80a1\u6587/front-end-code3",tags:[],version:"current",frontMatter:{slug:"front-end-code3",title:"\u524d\u7aef\u4ee3\u7801\u98983"},sidebar:"interview",previous:{title:"\u524d\u7aef\u4ee3\u7801\u98982",permalink:"/docs/interview/\u516b\u80a1\u6587/front-end-code2"}},u=[{value:"1. \u6570\u7ec4\u53bb\u91cd",id:"1-\u6570\u7ec4\u53bb\u91cd",children:[]},{value:"2. JSONP",id:"2-jsonp",children:[]},{value:"3. \u56fe\u7247\u61d2\u52a0\u8f7d",id:"3-\u56fe\u7247\u61d2\u52a0\u8f7d",children:[{value:"3.1 \u61d2\u52a0\u8f7d\u5b9e\u73b0\u539f\u7406",id:"31-\u61d2\u52a0\u8f7d\u5b9e\u73b0\u539f\u7406",children:[]},{value:"3.2 \u65b9\u6cd51\uff1aclientHeight\u3001scrollTop \u548c offsetTop",id:"32-\u65b9\u6cd51clientheightscrolltop-\u548c-offsettop",children:[]},{value:"3.3 \u65b9\u6cd52\uff1agetBoundingClientRect",id:"33-\u65b9\u6cd52getboundingclientrect",children:[]},{value:"3.4 \u65b9\u6cd53\uff1a\u6d4f\u89c8\u5668 API IntersectionObserver",id:"34-\u65b9\u6cd53\u6d4f\u89c8\u5668-api-intersectionobserver",children:[]},{value:"3.5 \u5176\u4ed6\u65b9\u6cd5",id:"35-\u5176\u4ed6\u65b9\u6cd5",children:[]},{value:"3.6 \u5b9e\u4f8b",id:"36-\u5b9e\u4f8b",children:[]},{value:"3.7 \u5c0f\u7ed3",id:"37-\u5c0f\u7ed3",children:[]}]},{value:"4. \u5343\u5206\u4f4d\u5206\u9694\u7b26",id:"4-\u5343\u5206\u4f4d\u5206\u9694\u7b26",children:[{value:"4.1 \u65b9\u6cd51\uff1a\u5faa\u73af",id:"41-\u65b9\u6cd51\u5faa\u73af",children:[]},{value:"4.2 \u65b9\u6cd52\uff1atoLocalString",id:"42-\u65b9\u6cd52tolocalstring",children:[]},{value:"4.3 \u65b9\u6cd53\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f\u548c replace \u51fd\u6570",id:"43-\u65b9\u6cd53\u6b63\u5219\u8868\u8fbe\u5f0f\u548c-replace-\u51fd\u6570",children:[]}]},{value:"5. \u4e8b\u4ef6\u5206\u53d1\u5668 EventEmitter",id:"5-\u4e8b\u4ef6\u5206\u53d1\u5668-eventemitter",children:[]},{value:"6. \u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u94fe\u5f0f\u67e5\u627e",id:"6-\u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u94fe\u5f0f\u67e5\u627e",children:[]},{value:"7. \u7b1b\u5361\u5c14\u79ef",id:"7-\u7b1b\u5361\u5c14\u79ef",children:[{value:"\u89e3\u6cd51",id:"\u89e3\u6cd51",children:[]},{value:"\u89e3\u6cd52",id:"\u89e3\u6cd52",children:[]}]},{value:"8. \u4f7f\u7528 raf \u6a21\u62df setTimeout \u4e0e setInterval",id:"8-\u4f7f\u7528-raf-\u6a21\u62df-settimeout-\u4e0e-setinterval",children:[]},{value:"9. React Hook \u5c01\u88c5\u4e00\u4e2a\u8ba1\u65f6\u5668",id:"9-react-hook-\u5c01\u88c5\u4e00\u4e2a\u8ba1\u65f6\u5668",children:[]}],d={toc:u};function k(e){var n=e.components,t=(0,r.Z)(e,c);return(0,l.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)(i.jA,{time:"2021-10-20",lastUpdate:"2021.10.30",mdxType:"InterviewComponent"}),(0,l.kt)("h2",{id:"1-\u6570\u7ec4\u53bb\u91cd"},"1. \u6570\u7ec4\u53bb\u91cd"),(0,l.kt)("p",null,"\u2003","\u2003","\u6570\u7ec4\u53bb\u91cd\u662f\u4e00\u9879\u57fa\u672c\u529f\u4e86\uff0c\u6709\u591a\u79cd\u65b9\u6cd5\u5b9e\u73b0\uff0c\u8fd9\u8fb9\u7b80\u5355\u5217\u4e86\u51e0\u4e2a\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u5047\u8bbe\u6709\u6570\u7ec4\u5982\u4e0b\uff0c\u6570\u7ec4 ",(0,l.kt)("inlineCode",{parentName:"p"},"arr")," \u4e2d\u6709\u5e94\u7528\u7c7b\u578b\u7684\u6570\u636e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"let inarr1 = [1, 2];\nlet inarr2 = {a: 'a', b: 'b'};\nlet arr = [1, 2, inarr1, 1, 5, inarr1, 2, 1, inarr2, inarr2];\nlet arr1 = [];\n")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"set")," \u53bb\u91cd"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"arr1 = [...new Set(arr)];\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"filter")," \u53bb\u91cd"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"arr1 = arr.filter((val, idx) => {\n    return arr.indexOf(val) === idx;\n});\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u7b80\u5355\u5faa\u73af"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"for (let val of arr) {\n  if (arr1.indexOf(val) === -1) {\n      arr1.push(val);\n  }\n}\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u6392\u5e8f\u540e\u53bb\u91cd"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"arr.sort();\nfor (let val of arr) {\n    if (arr1.length === 0 || arr1[arr1.length-1] !== val) {\n        arr1.push(val);\n    }\n}\n")))),(0,l.kt)("h2",{id:"2-jsonp"},"2. JSONP"),(0,l.kt)("p",null,"\u2003","\u2003","\u5728\u524d\u7aef\u9762\u8bd5\u4e2d\uff0cJSONP \u7edd\u5bf9\u662f\u4e00\u4e2a\u975e\u5e38\u975e\u5e38\u91cd\u8981\u7684\u77e5\u8bc6\u70b9\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u76f4\u63a5\u8ba9\u5199\u4ee3\u7801\uff0c\u66f4\u591a\u7684\u662f\u53e3\u5934\u63cf\u8ff0\uff0c\u4f46\u8981\u63cf\u8ff0\u6e05\u695a\u9700\u8981\u5bf9 JSONP \u7684\u5199\u6cd5\u975e\u5e38\u719f\u6089\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u672c\u535a\u5ba2\u5728\u5efa\u8bbe\u8fc7\u7a0b\u4e2d\u4e5f\u7528\u5230\u4e86 JSONP \u7684\u77e5\u8bc6\uff0c\u8be6\u60c5\u53ef\u770b",(0,l.kt)("a",{parentName:"p",href:"https://yleave.top/docs/%E5%8D%9A%E5%AE%A2%E5%BB%BA%E8%AE%BE/blog-header-component#%E4%BD%BF%E7%94%A8-jsonp-%E6%89%8B%E5%8A%A8%E8%8E%B7%E5%8F%96-pv-%E5%80%BC"},"\u4f7f\u7528 JSONP \u624b\u52a8\u83b7\u53d6 PV \u503c")),(0,l.kt)("hr",null),(0,l.kt)("p",null,"\u2003","\u2003","JSONP \u5373 JSON with Padding\u3002\u5b83\u662f\u501f\u52a9\u4e86 HTML \u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\u53ef\u8de8\u57df\u7684\u7279\u70b9\u6765\u8fdb\u884c ",(0,l.kt)("inlineCode",{parentName:"p"},"GET")," \u8bf7\u6c42\uff0c\u6211\u4eec\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"url")," \u90e8\u5206\u7684\u53c2\u6570\u4f20\u9012\uff0c\u7ed9\u51fa\u56de\u8c03\u7684\u51fd\u6570\u540d\uff0c\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"?callback=cbFunction"),"\uff0c\u7136\u540e\u54cd\u5e94\u4e2d\u8fd4\u56de\u8981\u6267\u884c\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"JS")," \u4ee3\u7801\uff0c\u4f7f\u7528\u5b57\u7b26\u4e32\u62fc\u63a5\u7684\u65b9\u5f0f\u4f20\u9012\u56de\u8c03\u51fd\u6570\u4e2d\u7684\u53c2\u6570\uff0c\u7136\u540e\u6d4f\u89c8\u5668\u63a5\u53d7\u54cd\u5e94\uff0c\u5c31\u76f4\u63a5\u6267\u884c\u4e86\u8fd4\u56de\u7684\u4ee3\u7801\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u56e0\u6b64 JSONP \u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u56de\u8c03\u51fd\u6570")," \u548c ",(0,l.kt)("strong",{parentName:"p"},"\u6570\u636e"),"\u3002\u56de\u8c03\u51fd\u6570\u662f\u5f53\u54cd\u5e94\u5230\u6765\u65f6\u8981\u5728\u9875\u9762\u4e2d\u8c03\u7528\u7684\u51fd\u6570\uff0c\u51fd\u6570\u540d\u4e00\u822c\u901a\u8fc7\u8bf7\u6c42 url \u4f20\u9012\uff1b\u800c\u6570\u636e\u901a\u8fc7\u670d\u52a1\u5668\u54cd\u5e94\u8bf7\u6c42\u65f6\u901a\u8fc7\u5b57\u7b26\u4e32\u62fc\u63a5\u4f5c\u4e3a\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u8fd4\u56de\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","JSONP \u4f18\u70b9\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4e0d\u53d7\u540c\u6e90\u7b56\u7565\u7684\u9650\u5236"),(0,l.kt)("li",{parentName:"ul"},"\u517c\u5bb9\u6027\u597d"),(0,l.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u7b80\u5355")),(0,l.kt)("p",null,"\u2003","\u2003","\u7f3a\u70b9\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53ea\u652f\u6301 ",(0,l.kt)("inlineCode",{parentName:"li"},"GET")," \u8bf7\u6c42"),(0,l.kt)("li",{parentName:"ul"},"\u5c5e\u4e8e\u5d4c\u5165\u5f0f\u811a\u672c\uff0c\u6709\u4e00\u5b9a\u5b89\u5168\u98ce\u9669")),(0,l.kt)("hr",null),(0,l.kt)("p",null,"\u2003","\u2003","JSONP \u7684\u5177\u4f53\u5b9e\u73b0\u53ef\u6839\u636e\u4f7f\u7528\u573a\u666f\u6765\u51b3\u5b9a\uff0c\u4e0d\u8fc7\u4f55\u79cd\u5b9e\u73b0\u90fd\u6709\u7740\u76f8\u540c\u7684\u6b65\u9aa4\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u9996\u5148\u662f\u4e00\u4e2a Promise \u94fe\u5f0f\u8c03\u7528\u7248\u672c\u7684 JSONP \u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u5728\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4f1a\u8fd4\u56de\u4e00\u4e2a Promise\uff0cPromise \u4e2d\u9996\u5148\u786e\u5b9a\u56de\u8c03\u51fd\u6570\u540d\uff0c\u82e5\u672a\u4f20\u5165\uff0c\u5219\u968f\u673a\u751f\u6210\u4e00\u4e2a\u51fd\u6570\u540d\uff0c\u518d\u521b\u5efa\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"script")," \u6807\u7b7e\u5e76\u5c06\u5b83\u52a0\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"body")," \u4e2d\uff0c\u968f\u540e\u6211\u4eec\u518d\u6839\u636e\u4f20\u5165\u7684 url \u548c\u6211\u4eec\u786e\u5b9a\u597d\u7684\u51fd\u6570\u540d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 URL\uff0c\u5e76\u5c06\u65b0\u7684 URL \u4f5c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"script")," \u6807\u7b7e\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\u503c\uff0c\u90a3\u4e48\u6b64\u65f6\u5c31\u4f1a\u5f00\u59cb\u7f51\u7edc\u8bf7\u6c42\u4e86\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u6700\u540e\uff0c\u6211\u4eec\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"window")," \u5bf9\u8c61\u4e0a\u6302\u8f7d\u4e00\u4e2a\u5168\u5c40\u51fd\u6570\uff0c\u51fd\u6570\u540d\u5c31\u662f\u6211\u4eec\u786e\u5b9a\u7684\u51fd\u6570\u540d\uff0c\u8be5\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"jsonp")," \u540e\u4f1a\u8fd4\u56de\u7684\u6570\u636e\uff0c\u7136\u540e\u5728\u51fd\u6570\u5185\u90e8\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"resolve")," \u65b9\u6cd5\u4f20\u9012\u6570\u636e\uff0c\u5e76\u5c06\u65b0\u521b\u5efa\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"script")," \u5143\u7d20\u4ece DOM \u6811\u4e2d\u79fb\u9664\u4ee5\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const chars = 'abcdefghijklmnopqrstuvwxyz';\n\nfunction randomString(strs, length) {\n    let str = '';\n    for (let i = 0; i < length; ++i) {\n        str += strs[Math.floor(Math.random() * strs.length)]\n    }\n\n    return str;\n}\n\nconst jsonp = ({url, params, callbackName}) => {\n    const generateURL = () => {\n        let str = `jsoncallback=${callbackName}`;\n\n        str += Object.keys(params).map(key => `${key}=${params[key]}`).join('&');\n\n        return `${url}?${str}`;\n    };\n\n    return new Promise((resolve, reject) => {\n        callbackName = callbackName || randomString(chars, 10);\n        let scriptEle = document.createElement('script');\n        scriptEle.src = generateURL();\n        document.body.appendChild(scriptEle);\n\n        // \u670d\u52a1\u5668\u8fd4\u56de\u5b57\u7b26\u4e32 'callbackName(data)'\uff0c\u6d4f\u89c8\u5668\u89e3\u6790\u5373\u53ef\u6267\u884c\n        // \u5728\u5168\u5c40\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u5904\u7406\u56de\u8c03\u65b9\u6cd5\n        window[callbackName] = (data) => {\n            resolve(data);\n            // \u6700\u540e\u518d\u79fb\u9664\u4e0d\u9700\u8981\u7684 dom \u8282\u70b9\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\n            document.body.removeChild(scriptEle);\n        };\n    });\n};\n\n// \u5b9e\u4f8b\uff0c\u4f7f\u7528\u83dc\u9e1f\u6559\u7a0b\u4e2d\u63d0\u4f9b\u7684\u63a5\u53e3\u8c03\u7528 jsonp \u65b9\u6cd5\njsonp({\n    url: 'https://www.runoob.com/try/ajax/jsonp.php',\n    callbackName: 'callbackFunction'\n}).then((data) => {\n    console.log(data)\n});\n")),(0,l.kt)("p",null,"\u2003","\u2003","\u8fd8\u6709\u4e00\u79cd\u4f20\u5165\u51fd\u6570\u7684\u7b80\u4fbf\u5199\u6cd5\uff0c\u8fd9\u79cd\u5199\u6cd5\u652f\u6301\u533f\u540d\u51fd\u6570\uff0c\u4e0d\u8fc7\u51fd\u6570\u540d\u9700\u8981\u6ce8\u610f\u907f\u514d\u51b2\u7a81\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function jsonp({url, callbackName, callback}) {\n    let script = document.createElement('script');\n    callbackName = callbackName || 'randomName';\n    let newURL = `${url}?jsoncallback=${callbackName}`;\n    script.src = newURL;\n    document.body.appendChild(script);\n\n    window[callbackName] = callback;\n}\n\njsonp({\n    url: 'https://www.runoob.com/try/ajax/jsonp.php', \n    callback: (data) => {console.log(data)},\n    // callbackName: 'callbackFunc'\n});\n")),(0,l.kt)("h2",{id:"3-\u56fe\u7247\u61d2\u52a0\u8f7d"},"3. \u56fe\u7247\u61d2\u52a0\u8f7d"),(0,l.kt)("p",null,"\u2003","\u2003","\u61d2\u52a0\u8f7d\u662f\u4e00\u79cd\u7f51\u9875\u6027\u80fd\u4f18\u5316\u7b56\u7565\uff0c\u82e5\u4e00\u4e2a\u9875\u9762\u4e2d\u5f53\u524d\u4e0d\u53ef\u89c1\u533a\u57df\u6709\u56fe\u7247\u9700\u8981\u52a0\u8f7d\uff0c\u90a3\u4e48\u53ef\u4ee5\u5ef6\u8fdf\u8be5\u56fe\u7247\u7684\u8bf7\u6c42\uff0c\u76f4\u5230\u8fbe\u5230\u8be5\u56fe\u7247\u7684\u53ef\u89c6\u533a\u57df\u4e3a\u6b62\u3002"),(0,l.kt)("h3",{id:"31-\u61d2\u52a0\u8f7d\u5b9e\u73b0\u539f\u7406"},"3.1 \u61d2\u52a0\u8f7d\u5b9e\u73b0\u539f\u7406"),(0,l.kt)("p",null,"\u2003","\u2003","\u7f51\u9875\u4e2d\u4e00\u822c\u5360\u7528\u8f83\u591a\u8d44\u6e90\u7684\u662f\u56fe\u7247\u6587\u4ef6\uff0c\u56e0\u6b64\u61d2\u52a0\u8f7d\u4e00\u822c\u662f\u9488\u5bf9\u56fe\u7247\u800c\u8a00\u7684\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u800c\u4e00\u5f20\u56fe\u7247\u5c31\u662f\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"<img>")," \u6807\u7b7e\uff0c\u56fe\u7247\u7684\u52a0\u8f7d\u6e90\u5c31\u662f\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\uff0c\u6d4f\u89c8\u5668\u53d1\u8d77\u8bf7\u6c42\u5c31\u662f\u6839\u636e\u5176\u662f\u5426\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\u6765\u51b3\u5b9a\u7684\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u56e0\u6b64\u53ef\u4ee5\u6839\u636e ",(0,l.kt)("inlineCode",{parentName:"p"},"<img>")," \u6807\u7b7e\u7684\u4f4d\u7f6e\uff0c\u5f53\u6807\u7b7e\u5728\u53ef\u89c6\u533a\u57df\u4e4b\u5916\u65f6\uff0c\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\u4e3a\u7a7a\uff0c\u800c\u5f53\u5373\u5c06\u8fdb\u5165\u53ef\u89c6\u533a\u57df\u65f6\uff0c\u8bbe\u7f6e\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"src")," \u5c5e\u6027\uff0c\u8ba9\u6d4f\u89c8\u5668\u53d1\u8d77\u56fe\u7247\u8bf7\u6c42\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u6240\u4ee5\u8bf4",(0,l.kt)("strong",{parentName:"p"},"\u61d2\u52a0\u8f7d\u7684\u8981\u70b9\u5c31\u662f\u53ef\u89c6\u533a\u57df\u7684\u5224\u65ad"),"\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u61d2\u52a0\u8f7d\u4f1a\u5728\u9875\u9762\u8fdb\u884c\u6eda\u52a8\u65f6\u8c03\u7528\u5224\u65ad\u51fd\u6570\uff0c\u56e0\u6b64",(0,l.kt)("strong",{parentName:"p"},"\u9700\u8981\u8fdb\u884c\u8282\u6d41\u4f18\u5316"),"\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u9996\u5148\uff0c\u7528\u4e00\u5e45\u56fe\u89e3\u91ca\u6d4f\u89c8\u5668\u7684\u5bbd\u9ad8\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://gitee.com/yleave/imagehost/raw/master/img/Dimensions-client.png",alt:"Dimensions-client"})),(0,l.kt)("h3",{id:"32-\u65b9\u6cd51clientheightscrolltop-\u548c-offsettop"},"3.2 \u65b9\u6cd51\uff1aclientHeight\u3001scrollTop \u548c offsetTop"),(0,l.kt)("p",null,"\u2003","\u2003","\u9996\u5148\uff0c\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e09\u4e2a\u5c5e\u6027\uff1a"),(0,l.kt)("img",{src:"https://gitee.com/yleave/imagehost/raw/master/img/image-20210224181307061.png",alt:"image-20210224181307061",style:{zoom:"60%"}}),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},(0,l.kt)("inlineCode",{parentName:"p"},"HTMLElement.offsetTop")," \u4e3a\u53ea\u8bfb\u5c5e\u6027\uff0c\u5b83\u8fd4\u56de\u5f53\u524d\u5143\u7d20\u76f8\u5bf9\u4e8e\u5176 ",(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/offsetParent"},(0,l.kt)("inlineCode",{parentName:"a"},"offsetParent"))," \u5143\u7d20\u7684\u9876\u90e8\u5185\u8fb9\u8ddd\u7684\u8ddd\u79bb\u3002"),(0,l.kt)("p",{parentName:"div"},(0,l.kt)("inlineCode",{parentName:"p"},"Element.scrollTop")," \u5c5e\u6027\u53ef\u4ee5\u83b7\u53d6\u6216\u8bbe\u7f6e\u4e00\u4e2a\u5143\u7d20\u7684\u5185\u5bb9\u5782\u76f4\u6eda\u52a8\u7684\u50cf\u7d20\u6570\u3002"),(0,l.kt)("p",{parentName:"div"},(0,l.kt)("inlineCode",{parentName:"p"},"HTMLElement.clientHeight")," \u5bf9\u4e8e\u6ca1\u6709\u5b9a\u4e49CSS\u6216\u8005\u5185\u8054\u5e03\u5c40\u76d2\u5b50\u7684\u5143\u7d20\u4e3a0\uff0c\u5426\u5219\uff0c\u5b83\u662f\u5143\u7d20\u5185\u90e8\u7684\u9ad8\u5ea6(\u5355\u4f4d\u50cf\u7d20)\uff0c\u5305\u542b\u5185\u8fb9\u8ddd\uff0c\u4f46",(0,l.kt)("strong",{parentName:"p"},"\u4e0d\u5305\u62ec"),"\u6c34\u5e73\u6eda\u52a8\u6761\u3001\u8fb9\u6846\u548c\u5916\u8fb9\u8ddd\u3002"),(0,l.kt)("p",{parentName:"div"},"\u2003","\u2003",(0,l.kt)("inlineCode",{parentName:"p"},"clientHeight")," \u53ef\u4ee5\u901a\u8fc7 CSS ",(0,l.kt)("inlineCode",{parentName:"p"},"height")," + CSS ",(0,l.kt)("inlineCode",{parentName:"p"},"padding")," - \u6c34\u5e73\u6eda\u52a8\u6761\u9ad8\u5ea6 (\u5982\u679c\u5b58\u5728)\u6765\u8ba1\u7b97\u3002"),(0,l.kt)("p",{parentName:"div"},"\u2003","\u2003",(0,l.kt)("inlineCode",{parentName:"p"},"clientHeight")," \u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"window.innerHeight")," \u6765\u66ff\u4ee3 \uff0c\u4e0d\u8fc7\u82e5\u6709\u6c34\u5e73\u6eda\u52a8\u6761\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"innerHeight")," \u4e5f\u4f1a\u5305\u62ec\u6eda\u52a8\u6761\u9ad8\u5ea6\u3002"),(0,l.kt)("p",{parentName:"div"},(0,l.kt)("inlineCode",{parentName:"p"},"document.documentElement")," \u603b\u662f\u4f1a\u8fd4\u56de\u4e00\u4e2a ",(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/html"},(0,l.kt)("inlineCode",{parentName:"a"},"html"))," \u5143\u7d20\uff0c\u4e14\u5b83\u4e00\u5b9a\u662f\u8be5\u6587\u6863\u7684\u6839\u5143\u7d20\u3002"))),(0,l.kt)("p",null,"\u2003","\u2003","\u90a3\u4e48\u7531\u4e0a\u56fe\u53ef\u77e5\uff0c\u9875\u9762\u7684\u9ad8\u5ea6\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"clientHeight"),"\uff0c\u82e5\u6709\u6eda\u8f6e\u7684\u8bdd\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"scrollTop")," \u4f1a\u662f\u5f53\u524d\u9875\u9762\u6eda\u52a8\u7684\u9ad8\u5ea6\uff0c\u800c ",(0,l.kt)("inlineCode",{parentName:"p"},"offsetTop")," \u4f1a\u662f\u5143\u7d20\u8ddd\u79bb\u9875\u9762\u9876\u90e8\u7684\u9ad8\u5ea6\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u56e0\u6b64\u5f53 ",(0,l.kt)("inlineCode",{parentName:"p"},"scrollTop + clientHeight = offsetTop")," \u65f6\uff0c\u5c31\u8bf4\u660e\u5143\u7d20\u5373\u5c06\u8fdb\u5165\u53ef\u89c6\u533a\u57df\uff0c\u56fe\u7247\u9700\u8981\u8fdb\u884c\u8bf7\u6c42\u4e86\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function getTop(e) {\n    let T = e.offsetTop;\n    while (e = e.offsetParent) {\n        T += e.offsetTop;\n    }\n\n    return T;\n}\n\nfunction lazyLoad(imgs) {\n    // \u89c6\u53e3\u9ad8\u5ea6\n    const viewHeight = document.documentElement.clientHeight;\n    // \u6eda\u52a8\u6761\u62c9\u4f38\u7684\u9ad8\u5ea6\n    const scrollTop = document.documentElement.scrollTop  || document.body.scrollTop;\n\n    for (let i = count; i < imgs.length; ++i) {\n        if (getTop(imgs[i]) <= viewHeight + scrollTop) {\n            if (!imgs[i].getAttribute('src')) {\n                imgs[i].src = imgs[i].getAttribute('data-src'); // \u56fe\u7247\u7684 url \u653e\u5728 data-src \u5c5e\u6027\u4e2d\n                count++;  // count \u503c\u7531\u4e8e\u51cf\u5c11\u5faa\u73af\u5f00\u9500\n            }\n        }\n    }\n}\n")),(0,l.kt)("h3",{id:"33-\u65b9\u6cd52getboundingclientrect"},"3.3 \u65b9\u6cd52\uff1agetBoundingClientRect"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect"},"getBoundingClientRect MDN\u6587\u6863")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"Element.getBoundingClientRect()")),"  \u65b9\u6cd5\u8fd4\u56de\u5143\u7d20\u7684\u5927\u5c0f\u53ca\u5176\u76f8\u5bf9\u4e8e\u89c6\u53e3\u7684\u4f4d\u7f6e\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u662f\u6807\u51c6\u76d2\u5b50\u6a21\u578b\uff0c\u5143\u7d20\u7684\u5c3a\u5bf8\u7b49\u4e8e",(0,l.kt)("inlineCode",{parentName:"p"},"width/height")," + ",(0,l.kt)("inlineCode",{parentName:"p"},"padding")," + ",(0,l.kt)("inlineCode",{parentName:"p"},"border-width"),"\u7684\u603b\u548c\u3002\u5982\u679c",(0,l.kt)("inlineCode",{parentName:"p"},"box-sizing: border-box"),"\uff0c\u5143\u7d20\u7684\u7684\u5c3a\u5bf8\u7b49\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"width/height"),"\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5305\u542b\u5b8c\u6574\u5143\u7d20\u7684\u6700\u5c0f\u77e9\u5f62\uff0c\u5e76\u4e14\u62e5\u6709",(0,l.kt)("inlineCode",{parentName:"p"},"left"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"top"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"right"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"bottom"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"x"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"y"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"width"),", \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"height"),"\u8fd9\u51e0\u4e2a\u4ee5\u50cf\u7d20\u4e3a\u5355\u4f4d\u7684\u53ea\u8bfb\u5c5e\u6027\u7528\u4e8e\u63cf\u8ff0\u6574\u4e2a\u8fb9\u6846\u3002\u9664\u4e86",(0,l.kt)("inlineCode",{parentName:"p"},"width")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"height")," \u4ee5\u5916\u7684\u5c5e\u6027\u662f\u76f8\u5bf9\u4e8e",(0,l.kt)("strong",{parentName:"p"},"\u89c6\u56fe\u7a97\u53e3\u7684\u5de6\u4e0a\u89d2"),"\u6765\u8ba1\u7b97\u7684\u3002")),(0,l.kt)("img",{src:"https://gitee.com/yleave/imagehost/raw/master/img/rect.png",alt:"rect",style:{zoom:"50%"}}),(0,l.kt)("p",null,"\u2003","\u2003","\u56e0\u6b64\u4f7f\u7528 DOM \u5143\u7d20\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"getBoundingClientReact().top")," \u5c5e\u6027\u5c31\u80fd\u76f4\u63a5\u5224\u65ad\u56fe\u7247\u662f\u5426\u51fa\u73b0\u5728\u4e86\u5f53\u524d\u89c6\u53e3\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function lazyLoad(imgs) {\n    let viewHeight = document.documentElement.clientHeight;\n\n    for (let i = count; i < imgs.length; ++i) {\n        if (imgs[i].getBoundingClientRect().top <= viewHeight) {\n            if (!imgs[i].getAttribute('src')) {\n                imgs[i].src = imgs[i].getAttribute('data-src');\n                count++;\n            }\n        }\n    }\n}\n")),(0,l.kt)("h3",{id:"34-\u65b9\u6cd53\u6d4f\u89c8\u5668-api-intersectionobserver"},"3.4 \u65b9\u6cd53\uff1a\u6d4f\u89c8\u5668 API IntersectionObserver"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver"},"MDN\u6587\u6863")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html"},"\u962e\u4e00\u5cf0 IntersectionObserver \u6559\u7a0b")),(0,l.kt)("p",null,"\u2003","\u2003",(0,l.kt)("inlineCode",{parentName:"p"},"IntersectionObserver")," \u6d4f\u89c8\u5668\u5185\u7f6e\u7684 API\uff0c\u5b9e\u73b0\u4e86\u76d1\u542c window \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"scroll")," \u4e8b\u4ef6\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"\u5224\u65ad\u662f\u5426\u5728\u89c6\u53e3\u4e2d")," \u4ee5\u53ca ",(0,l.kt)("inlineCode",{parentName:"p"},"\u8282\u6d41")," \u4e09\u5927\u529f\u80fd\u3002\u8be5 API \u9700\u8981 polyfill\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"changes")," \u662f",(0,l.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserverEntry"},(0,l.kt)("inlineCode",{parentName:"a"},"IntersectionObserverEntry"))," \u5bf9\u8c61\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5bf9\u8c61\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"target")," \u662f\u5b9e\u9645\u53ef\u89c6\u60c5\u51b5\u53d1\u751f\u6539\u53d8\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"dom")," \u5143\u7d20\u3002"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"getElementsByTagName")," \u8fd4\u56de\u7684\u662f\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"li"},"HTMLCollection"),"\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"Array.from")," \u6765\u8f6c\u6362\u4e00\u4e0b\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const imgs = document.getElementsByTagName('img');\n\nconst observer = new IntersectionObserver(changes => {\n    changes.forEach(dom => {\n        if (dom.isIntersecting) {\n            dom.target.src = dom.target.getAttribute('data-src');\n            // \u5f53\u52a0\u8f7d\u540e\u5c31\u4ece\u76d1\u89c6\u5668\u4e2d\u79fb\u9664\n            observer.unobserve(dom.target);\n        }\n    });\n});\n\nArray.from(imgs).forEach(dom => observer.observe(dom));\n")),(0,l.kt)("h3",{id:"35-\u5176\u4ed6\u65b9\u6cd5"},"3.5 \u5176\u4ed6\u65b9\u6cd5"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5f00\u6e90\u5e93\u5982 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/aFarkas/lazysizes"},"https://github.com/aFarkas/lazysizes")," \uff08\u6ed1\u7a3d")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"\u4f7f\u7528 html5 \u65b0\u7279\u6027\uff08\u672a\u5b9e\u64cd\u8fc7\uff09"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},'<img src="image.jpg" alt="..." loading="lazy">\n<iframe src="video-player.html" title="..." loading="lazy"></iframe>\n')))),(0,l.kt)("h3",{id:"36-\u5b9e\u4f8b"},"3.6 \u5b9e\u4f8b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html"},'<head>\n    <style>\n        body {\n            height: 3000px;\n        }\n        img {\n            width: 500px;\n            height: 500px;\n            object-fit: scale-down;\n        }\n    </style>\n</head>\n<body>\n    <img data-src="./imgs/1.png">\n    <img data-src="./imgs/2.png">\n    <img data-src="./imgs/3.png">\n    <img data-src="./imgs/4.png">\n    <img data-src="./imgs/5.png">\n    <img data-src="./imgs/6.png">\n    <img data-src="./imgs/7.png">\n    <img data-src="./imgs/8.png">\n<script>\n    // \u65b9\u6cd51\uff1aclientHeight\u3001scrollTop\u3001offsetTop\n    let imgs = document.getElementsByTagName(\'img\'), count = 0;\n\n    // offsetTop \u662f\u5143\u7d20\u4e0e offsetParent \u7684\u8ddd\u79bb\uff0c\u5faa\u73af\u83b7\u53d6\u76f4\u5230\u8fbe\u5230\u9875\u9762\u9876\u90e8\n    function getTop(e) {\n        let T = e.offsetTop;\n        while (e = e.offsetParent) {\n            T += e.offsetTop;\n        }\n\n        return T;\n    }\n\n    function lazyLoad(imgs) {\n        // \u89c6\u53e3\u9ad8\u5ea6\n        let viewHeight = document.documentElement.clientHeight;\n        // \u6eda\u52a8\u6761\u62c9\u4f38\u7684\u9ad8\u5ea6\n        let scrollTop = document.documentElement.scrollTop  || document.body.scrollTop ;\n\n        for (let i = count; i < imgs.length; ++i) {\n            if (getTop(imgs[i]) <= viewHeight + scrollTop) {\n                if (!imgs[i].getAttribute(\'src\')) {\n                    imgs[i].src = imgs[i].getAttribute(\'data-src\');\n                    count++;\n                }\n            }\n        }\n    }\n\n    function throttle(fn, wait, ...args) {\n        let activeTime = 0;\n\n        return function() {\n            let current = +new Date();\n            if (wait <= current - activeTime) {\n                fn.apply(this, args.concat(...arguments));\n                activeTime = current;\n            }\n        };\n    }\n    // \u9996\u6b21\u52a0\u8f7d\n    window.onload = lazyLoad(imgs);\n    window.onscroll = throttle(lazyLoad, 100, imgs);\n<\/script>\n</body>\n')),(0,l.kt)("h3",{id:"37-\u5c0f\u7ed3"},"3.7 \u5c0f\u7ed3"),(0,l.kt)("p",null,"\u2003","\u2003","\u4e0a\u9762\u4ecb\u7ecd\u7684\u524d\u4e09\u79cd\u65b9\u6cd5\uff0c\u5176\u4e2d\u524d\u4e24\u79cd\u65b9\u6cd5\u662f\u6709\u4e00\u5b9a\u7f3a\u9677\u7684\uff0c\u5b83\u4eec\u53ea\u6bd4\u8f83\u4e86\u8ddd\u79bb\u9875\u9762\u9876\u7aef\u7684\u8ddd\u79bb\uff0c\u56e0\u6b64\u82e5\u5237\u65b0\u6d4f\u89c8\u5668\u65f6\uff0c\u6240\u5904\u4f4d\u7f6e\u7684\u4e0a\u65b9\u6240\u6709\u53ef\u89c1\u548c\u4e0d\u53ef\u89c1\u7684\u56fe\u7247\u90fd\u4f1a\u88ab\u52a0\u8f7d\u51fa\u6765\uff0c\u56e0\u6b64\u5e76\u4e0d\u662f\u5b8c\u5907\u7684\u61d2\u52a0\u8f7d\u3002"),(0,l.kt)("p",null,"\u2003","\u2003","\u4e0d\u8fc7\u7b2c\u4e09\u79cd\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"IntersectionObserver")," \u7684\u65b9\u6cd5\u5219\u4e0d\u4f1a\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u7684\u5f31\u52bf\u662f\u89c2\u5bdf\u5668\u5728\u8fdb\u7a0b\u4e2d\u7684\u4f18\u5148\u7ea7\u4f1a\u6bd4\u8f83\u4f4e\u4e14\u9700\u8981\u8003\u8651\u517c\u5bb9\u6027\u95ee\u9898\u3002"),(0,l.kt)("h2",{id:"4-\u5343\u5206\u4f4d\u5206\u9694\u7b26"},"4. \u5343\u5206\u4f4d\u5206\u9694\u7b26"),(0,l.kt)("p",null,"\u2003","\u2003","\u5343\u5206\u4f4d\u5206\u9694\u7b26\u5c31\u662f\u5bf9\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u6570\u5b57\uff0c\u5728\u5408\u9002\u7684\u5730\u65b9\u63d2\u5165\u5206\u9694\u7b26 ",(0,l.kt)("inlineCode",{parentName:"p"},",")," \uff0c\u4f7f\u5f97\u6570\u5b57\u66f4\u52a0\u6e05\u6670\uff0c\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"console.log(numFormat(123456789.1234)); //123,456,789.1234\nconsole.log(numFormat(12345.12));   //12,345.12\nconsole.log(numFormat(12345.)); // 12,345\nconsole.log(numFormat(123));    // 123\n")),(0,l.kt)("h3",{id:"41-\u65b9\u6cd51\u5faa\u73af"},"4.1 \u65b9\u6cd51\uff1a\u5faa\u73af"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function numFormat(num) {\n    // \u5148\u5c06\u5c0f\u6570\u90e8\u5206\u548c\u6574\u6570\u90e8\u5206\u5206\u5f00\n    num = num.toString().split('.');\n    // \u7ffb\u8f6c\u6574\u6570\u90e8\u5206\uff0c\u4fbf\u4e8e\u5904\u7406\n    let arr = num[0].split('').reverse();\n    let res = [];\n\n    for (let i = 0; i < arr.length; ++i) {\n        if (i % 3 === 0 && i !== 0) {\n            res.push(',');\n        }\n        res.push(arr[i]);\n    }\n\n    // \u7ffb\u8f6c\u56de\u6765\n    res = res.reverse().join('');\n\n    // \u82e5\u6709\u5c0f\u6570\u90e8\u5206\uff0c\u518d\u52a0\u4e0a\u5c0f\u6570\u90e8\u5206\n    if (num[1]) {\n        res += '.' + num[1];\n    }\n\n    return res;\n}\n")),(0,l.kt)("h3",{id:"42-\u65b9\u6cd52tolocalstring"},"4.2 \u65b9\u6cd52\uff1atoLocalString"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toLocaleString"},"toLocaleString MDN \u6587\u6863")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"(123456789.1234).toLocaleString(); //123,456,789.123 \uff01\uff01 \u6ce8\u610f\u8fd9\u91cc\u4f1a\u8fdb\u884c\u56db\u820d\u4e94\u5165\n(12345.12).toLocaleString();   //12,345.12\n(12345.).toLocaleString(); // 12,345\n(123).toLocaleString();    // 123\n")),(0,l.kt)("h3",{id:"43-\u65b9\u6cd53\u6b63\u5219\u8868\u8fbe\u5f0f\u548c-replace-\u51fd\u6570"},"4.3 \u65b9\u6cd53\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f\u548c replace \u51fd\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function numFormat(num){\n    const res = num.toString().replace(/\\d+/, function(n){ // \u5148\u63d0\u53d6\u6574\u6570\u90e8\u5206\n        return n.replace(/(\\d)(?=(\\d{3})+$)/g, function($1){\n            return $1+",";\n        });\n    });\n    return res;\n}\n\nconst a = 1234567894532;\nconst b = 673439.4542;\nconsole.log(numFormat(a)); // "1,234,567,894,532"\nconsole.log(numFormat(b)); // "673,439.4542"\n')),(0,l.kt)("h4",{id:"\u63a8\u8350\u9605\u8bfb"},"\u63a8\u8350\u9605\u8bfb"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://link.jianshu.com/?t=http://deerchao.net/tutorials/regex/regex.htm"},"\u6b63\u5219\u8868\u8fbe\u5f0f30\u5206\u949f\u5165\u95e8\u6559\u7a0b"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://link.jianshu.com/?t=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace"},"String.prototype.replace()")))),(0,l.kt)("h2",{id:"5-\u4e8b\u4ef6\u5206\u53d1\u5668-eventemitter"},"5. \u4e8b\u4ef6\u5206\u53d1\u5668 EventEmitter"),(0,l.kt)("p",null,"\u2003","\u2003","\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684 EventEmitter \u7c7b\uff0c\u9700\u8981\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"once"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"on"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"off"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"emit")," \u65b9\u6cd5"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"once")," \u8868\u793a\u8be5\u7c7b\u578b\u7684\u4e8b\u4ef6\u53ea\u89e6\u53d1\u4e00\u6b21\u5c31\u5220\u9664")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"on")," \u8868\u793a\u6302\u8f7d\u4e00\u4e2a\u7c7b\u578b\u7684\u4e8b\u4ef6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"off")," \u8868\u793a\u5378\u8f7d\u4e00\u4e2a\u7c7b\u578b\u7684\u4e8b\u4ef6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"emit")," \u8868\u793a\u5bf9\u67d0\u4e00\u7c7b\u578b\u7684\u4e8b\u4ef6\u8fdb\u884c\u4e00\u6b21\u5206\u53d1"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"class EventEmitter {\n    constructor() {\n        this.handlers = {};\n    }\n\n    // \u6ce8\u518c\u4e8b\u4ef6\u56de\u8c03\n    on(eventName, cb) {\n        const handlers = this.handlers;\n\n        if (!handlers[eventName]) {\n            handlers[eventName] = [];\n        }\n\n        handlers[eventName].push(cb);\n    }\n\n    // \u79fb\u9664\u67d0\u4e2a\u4e8b\u4ef6\u56de\u8c03\u961f\u5217\u4e2d\u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\n    off(eventName, cb) {\n        const callbacks = this.handlers;\n\n        if (!callbacks) return;\n\n        const idx = callbacks.indexOf(cb);\n        if (idx !== -1) {\n            callbacks.splice(idx, 1);\n        }\n    }\n\n    // \u89e6\u53d1\u67d0\u7c7b\u4e8b\u4ef6\u4e2d\u6ce8\u518c\u7684\u6240\u6709\u56de\u8c03\n    emit(eventName, ...args) {\n        const callbacks = this.handlers[eventName];\n\n        if (callbacks) {\n            // \u5bf9\u4e8b\u4ef6\u961f\u5217\u505a\u4e00\u6b21\u6d45\u62f7\u8d1d\uff0c\u4e3b\u8981\u662f\u9632\u6b62 once \u6ce8\u518c\u7684\u56de\u8c03\u5728\u89e6\u53d1\u540e\u5bf9\u8c03\u7528\u987a\u5e8f\u9020\u6210\u5f71\u54cd\n            const _callbacks = callbacks.slice();\n            _callbacks.forEach(cb => {\n                cb(...args);\n            });\n        }\n    }\n\n    once(eventName, cb) {\n        const wrappedCb = (...args) => {\n            cb(...args);\n            this.off(eventName, cb);\n        };\n\n        this.on(eventName, wrappedCb);\n    }\n}\n")),(0,l.kt)("h2",{id:"6-\u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u94fe\u5f0f\u67e5\u627e"},"6. \u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u94fe\u5f0f\u67e5\u627e"),(0,l.kt)("p",null,"\u2003","\u2003","\u5b9e\u73b0\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"get")," \u51fd\u6570\uff0c\u4f20\u5165\u4e09\u4e2a\u53c2\u6570\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"get(obj, chain, default)"),"\uff0c\u82e5\u80fd\u4ece\u7ed9\u5b9a\u5bf9\u8c61\u4e2d\u627e\u5230\u5c5e\u6027\u503c\uff0c\u5219\u8fd4\u56de\uff0c\u5426\u5219\u627e\u4e0d\u5230\u8fd4\u56de\u9ed8\u8ba4\u503c\uff1a"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5f53\u65f6\u770b\u5230\u9898\u76ee\u4e00\u62cd\u8111\u888b\u60f3\u51fa\u6765\u7684\uff0c\u6709\u66f4\u597d\u7684\u89e3\u6cd5\u6b22\u8fce\u5206\u4eab~")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const obj = {\n    a: {\n        b: [{\n            c:1\n        }]\n    }\n};\n\nconsole.log(get(obj, 'a.b[0].c', 0)); // 1\nconsole.log(get(obj, 'a.b.c', 0)); // 0\n\nfunction get(obj, chain, defaultVal) {\n    if (chain.length === 0) return defaultVal;\n\n    chain = chain.split('.');\n\n    const getVal = (curObj, idx) => {\n        // \u82e5\u627e\u4e0d\u5230\uff0c\u5219\u5f53\u524d\u7684 curObj \u4f1a\u662f undefined\uff0c\u5219\u8fd4\u56de\u9ed8\u8ba4\u503c\n        if (!curObj) return defaultVal;\n\n        // \u5426\u5219\u82e5\u627e\u5230\u5c3e\uff0c\u8fd4\u56de\u67e5\u8be2\u503c\n        if (idx === chain.length) return curObj;\n\n        let prop = chain[idx];\n        const flag = prop.indexOf('[') !== -1;\n        let nextObj;\n\n        // \u5206\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 [] \u8bbf\u95ee\u5c5e\u6027\u503c\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 . \u8bbf\u95ee\u5c5e\u6027\u503c\n        if (flag) {\n            let start = prop.indexOf('[');\n            let end = prop.length - 1;\n            while (prop[end] !== ']') end--;\n\n            let nextProp = prop.slice(0, start);\n            let arrayProp = prop.slice(start + 1, end);\n\n            nextObj = curObj[nextProp] && curObj[nextProp][arrayProp];\n        } else {\n            nextObj = curObj[prop];\n        }\n\n        // \u9012\u5f52\u67e5\u627e\n        return getVal(nextObj, idx + 1);\n    };\n\n    return getVal(obj, 0);\n}\n")),(0,l.kt)("h2",{id:"7-\u7b1b\u5361\u5c14\u79ef"},"7. \u7b1b\u5361\u5c14\u79ef"),(0,l.kt)("p",null,"\u2003","\u2003","\u8981\u6c42\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"const list = [\n    ['\u70ed', '\u51b7', '\u51b0'],\n    ['\u5927', '\u4e2d', '\u5c0f'],\n    ['\u91cd\u8fa3', '\u5fae\u8fa3'],\n    ['\u91cd\u9ebb', '\u5fae\u9ebb'],\n];\n\n// \u6839\u636e list \u8ba1\u7b97\u6240\u6709\u7ec4\u5408\u7ed3\u679c\n[\n  '\u70ed\u5927\u91cd\u8fa3\u91cd\u9ebb', '\u70ed\u5927\u91cd\u8fa3\u5fae\u9ebb', '\u70ed\u5927\u5fae\u8fa3\u91cd\u9ebb',\n  '\u70ed\u5927\u5fae\u8fa3\u5fae\u9ebb', '\u70ed\u4e2d\u91cd\u8fa3\u91cd\u9ebb', '\u70ed\u4e2d\u91cd\u8fa3\u5fae\u9ebb',\n  '\u70ed\u4e2d\u5fae\u8fa3\u91cd\u9ebb', '\u70ed\u4e2d\u5fae\u8fa3\u5fae\u9ebb', '\u70ed\u5c0f\u91cd\u8fa3\u91cd\u9ebb',\n  '\u70ed\u5c0f\u91cd\u8fa3\u5fae\u9ebb', '\u70ed\u5c0f\u5fae\u8fa3\u91cd\u9ebb', '\u70ed\u5c0f\u5fae\u8fa3\u5fae\u9ebb',\n  '\u51b7\u5927\u91cd\u8fa3\u91cd\u9ebb', '\u51b7\u5927\u91cd\u8fa3\u5fae\u9ebb', '\u51b7\u5927\u5fae\u8fa3\u91cd\u9ebb',\n  '\u51b7\u5927\u5fae\u8fa3\u5fae\u9ebb', '\u51b7\u4e2d\u91cd\u8fa3\u91cd\u9ebb', '\u51b7\u4e2d\u91cd\u8fa3\u5fae\u9ebb',\n  '\u51b7\u4e2d\u5fae\u8fa3\u91cd\u9ebb', '\u51b7\u4e2d\u5fae\u8fa3\u5fae\u9ebb', '\u51b7\u5c0f\u91cd\u8fa3\u91cd\u9ebb',\n  '\u51b7\u5c0f\u91cd\u8fa3\u5fae\u9ebb', '\u51b7\u5c0f\u5fae\u8fa3\u91cd\u9ebb', '\u51b7\u5c0f\u5fae\u8fa3\u5fae\u9ebb',\n  '\u51b0\u5927\u91cd\u8fa3\u91cd\u9ebb', '\u51b0\u5927\u91cd\u8fa3\u5fae\u9ebb', '\u51b0\u5927\u5fae\u8fa3\u91cd\u9ebb',\n  '\u51b0\u5927\u5fae\u8fa3\u5fae\u9ebb', '\u51b0\u4e2d\u91cd\u8fa3\u91cd\u9ebb', '\u51b0\u4e2d\u91cd\u8fa3\u5fae\u9ebb',\n  '\u51b0\u4e2d\u5fae\u8fa3\u91cd\u9ebb', '\u51b0\u4e2d\u5fae\u8fa3\u5fae\u9ebb', '\u51b0\u5c0f\u91cd\u8fa3\u91cd\u9ebb',\n  '\u51b0\u5c0f\u91cd\u8fa3\u5fae\u9ebb', '\u51b0\u5c0f\u5fae\u8fa3\u91cd\u9ebb', '\u51b0\u5c0f\u5fae\u8fa3\u5fae\u9ebb'\n]\n")),(0,l.kt)("h3",{id:"\u89e3\u6cd51"},"\u89e3\u6cd51"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const list = [\n    ['\u70ed', '\u51b7', '\u51b0'],\n    ['\u5927', '\u4e2d', '\u5c0f'],\n    ['\u91cd\u8fa3', '\u5fae\u8fa3'],\n    ['\u91cd\u9ebb', '\u5fae\u9ebb'],\n];\n\nconst ans = list.reduce((acc, cur) => {\n    const next = [];\n    for (let a of acc) {\n        for (let b of cur) {\n            next.push(a + b);\n        }\n    }\n\n    return next;\n});\n\nconsole.log(ans);\n")),(0,l.kt)("h3",{id:"\u89e3\u6cd52"},"\u89e3\u6cd52"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const list = [\n    ['\u70ed', '\u51b7', '\u51b0'],\n    ['\u5927', '\u4e2d', '\u5c0f'],\n    ['\u91cd\u8fa3', '\u5fae\u8fa3'],\n    ['\u91cd\u9ebb', '\u5fae\u9ebb'],\n];\n\nconst ans = list.reduce((acc, cur) => {\n    return acc.reduce((ret, a) => {\n        ret.push(...cur.map(b => a + b));\n        return ret;\n    }, []);\n});\n\nconsole.log(ans);\n")),(0,l.kt)("h2",{id:"8-\u4f7f\u7528-raf-\u6a21\u62df-settimeout-\u4e0e-setinterval"},"8. \u4f7f\u7528 raf \u6a21\u62df setTimeout \u4e0e setInterval"),(0,l.kt)("p",null,"\u2003","\u2003","\u5b9e\u73b0\u601d\u8def\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"requestAnimation")," \u4f1a\u5728\u6bcf\u4e00\u5e27\u7684\u5e27\u9996\u88ab\u8c03\u7528\uff0c\u56e0\u6b64\u6211\u4eec",(0,l.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u4e00\u79d2 60 \u5e27"),"\uff0c\u90a3\u4e48\u6211\u4eec\u6bcf\u8c03\u7528\u4e00\u6b21 RFA \u5c31\u662f 1000 / 60 ~= 16.67 \u6beb\u79d2\uff0c\u56e0\u6b64\u80fd\u591f\u5927\u81f4\u6a21\u62df\u8ba1\u65f6\u5668\u4e86"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const mockSettimeout = (fn, wait) => {\n    let t = 0;\n\n    function loop() {\n        t++;\n        const time = (1000 / 60) * t;\n        if (time >= wait) {\n            fn.apply(this, [...arguments]);\n            cancelAnimationFrame(loop);\n        } else {\n            requestAnimationFrame(loop);\n        }\n    };\n\n    requestAnimationFrame(loop);\n};\n\nlet prev = +new Date();\nmockSettimeout(() => {\n    console.log('aaa', +new Date() - prev);\n}, 1000)\n")),(0,l.kt)("p",null,"\u2003","\u2003","\u6b64\u5916\uff0c\u4e00\u4e2a\u6539\u8fdb\u7684\u65b9\u6cd5\u662f\u5728\u6bcf\u6b21\u8c03\u7528 rfa \u65f6\u8bb0\u5f55\u4e0a\u4e00\u6b21\u56de\u8c03\u7684\u8c03\u7528\u65f6\u95f4\uff0c\u7136\u540e\u7d2f\u8ba1\u82b1\u8d39\u65f6\u95f4\u4e0e wait \u5bf9\u6bd4\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u5e27\u7387\u5c0f\u4e8e 60 \u5e27\u60c5\u51b5\u4e0b\u7684\u8bef\u5dee\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const mockSettimeout = (fn, wait) => {\n    let total = 0;\n    let prev = +new Date();\n\n    function loop() {\n        const now = +new Date();\n        total += now - prev;\n        prev = now;\n\n        if (total >= wait) {\n            fn.apply(this, [...arguments]);\n            cancelAnimationFrame(loop);\n        } else {\n            requestAnimationFrame(loop);\n        }\n    };\n\n    requestAnimationFrame(loop);\n};\n\nlet prev = +new Date();\nmockSettimeout(() => {\n    console.log('aaa', +new Date() - prev);\n}, 1000)\n")),(0,l.kt)("p",null,"\u2003","\u2003","\u6709\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"setTimeout")," ",(0,l.kt)("inlineCode",{parentName:"p"},"\u7684\u7ecf\u9a8c\u540e\uff0csetInterval")," \u7684\u6a21\u62df\u5c31\u5f88\u7b80\u5355\u4e86\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const mockSetInterval = (fn, wait) => {\n    let total = 0;\n    let prev = +new Date();\n\n    function loop() {\n        const now = +new Date();\n        total += now - prev;\n        prev = now;\n\n        if (total >= wait) {\n            total -= 1000; \n            fn.apply(this, [...arguments]);\n        }\n        requestAnimationFrame(loop);\n    };\n\n    requestAnimationFrame(loop);\n};\n\nlet prev = +new Date();\nmockSetInterval(() => {\n    console.log('aaa', +new Date() - prev);\n}, 1000)\n")),(0,l.kt)("h2",{id:"9-react-hook-\u5c01\u88c5\u4e00\u4e2a\u8ba1\u65f6\u5668"},"9. React Hook \u5c01\u88c5\u4e00\u4e2a\u8ba1\u65f6\u5668"),(0,l.kt)("p",null,"\u2003","\u2003","\u4e3b\u8981\u601d\u8def\u5c31\u662f\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"useRef")," \u6765\u4fdd\u5b58\u56de\u8c03\u51fd\u6570\u4ee5\u53ca\u8ba1\u65f6\u5668\uff0c\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"useCallback")," \u6765\u7f13\u5b58\u91cd\u7f6e\u51fd\u6570\u4ee5\u53ca\u6e05\u9664\u51fd\u6570\uff0c\u5f53\u4f20\u5165\u56de\u8c03\u6216\u662f\u5ef6\u8fdf\u65f6\u95f4\u4fee\u6539\u65f6\uff0c\u518d\u83b7\u53d6\u66f4\u65b0\uff0c\u5177\u4f53\u53ef\u770b\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import { useEffect, useRef, useCallback } from "react";\n\nexport default function useTimeoutFn(fn, ms) {\n    // \u8868\u793a\u5f53\u524d\u662f\u5426\u5b8c\u6210\u8ba1\u65f6\n    const ready = useRef(false);\n    const timeout = useRef();\n    const callback = useRef(fn);\n\n    const isReady = useCallback(() => ready.current, []);\n\n    // \u8bbe\u7f6e/\u91cd\u7f6e\u5b9a\u65f6\u5668\n    const set = useCallback(() => {\n        ready.current = false;\n        // \u82e5 timeout \u6709\u503c\uff0c\u5219\u8868\u793a\u662f\u91cd\u7f6e\uff0c\u90a3\u4e48\u6e05\u9664\u524d\u9762\u8bbe\u7f6e\u7684\u8ba1\u65f6\u5668\n        timeout.current && clearTimeout(timeout.current);\n\n        timeout.current = setTimeout(() => {\n            ready.current = true;\n            callback.current();\n        }, ms);\n\n    }, [ms]);\n\n    const clear = useCallback(() => {\n        ready.current = null;\n        timeout.current && clearTimeout(timeout.current);\n    }, []);\n\n    // \u5f53\u56de\u8c03\u51fd\u6570 fn \u66f4\u65b0\u65f6\uff0c\u91cd\u7f6e fn\n    useEffect(() => {\n        callback.current = fn;\n    }, [fn]);\n\n    // \u7b2c\u4e00\u6b21\u6302\u8d77\u65f6\u8bbe\u7f6e\u5b9a\u65f6\u5668\uff0c\u5f53\u7ec4\u4ef6\u5378\u8f7d\u65f6\u6e05\u7a7a\u8ba1\u65f6\u5668\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\n    useEffect(() => {\n        set();\n\n        return clear;\n    }, [ms]);\n\n    return [isReady, clear, set]\n}\n')),(0,l.kt)("p",null,"\u2003","\u2003","demo \u5b9e\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import React, { useState, useCallback } from 'react';\nimport useTimeoutFn from './useTimeoutFn';\nimport './App.css';\n\n\nconst App = () => {\n  const [state, setState] = React.useState('Not called yet');\n\n  function fn() {\n    setState(`called at ${Date.now()}`);\n  }\n\n  const [isReady, cancel, reset] = useTimeoutFn(fn, 3000);\n  const cancelButtonClick = useCallback(() => {\n    if (isReady() === false) {\n      cancel();\n      setState(`cancelled`);\n    } else {\n      reset();\n      setState('Not called yet');\n    }\n  }, []);\n\n  const readyState = isReady();\n\n  return (\n    <div>\n      <div>{readyState !== null ? 'Function will be called in 3 seconds' : 'Timer cancelled'}</div>\n      <button onClick={cancelButtonClick}> {readyState === false ? 'cancel' : 'restart'} timeout</button>\n      <br />\n      <div>Function state: {readyState === false ? 'Pending' : readyState ? 'Called' : 'Cancelled'}</div>\n      <div>{state}</div>\n    </div>\n  );\n};\n\nexport default App;\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://streamich.github.io/react-use/?path=/story/animation-usetimeoutfn--docs"},"demo \u6765\u6e90"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("a",{parentName:"p",href:"https://github.com/streamich/react-use/blob/master/src/useTimeoutFn.ts"},"\u6e90\u7801")))),(0,l.kt)(o.Z,{mdxType:"Comment"}))}k.isMDXComponent=!0}}]);